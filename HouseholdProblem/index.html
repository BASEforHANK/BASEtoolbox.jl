<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Household problem · Documentation for BASEforHANK module</title><meta name="title" content="Household problem · Documentation for BASEforHANK module"/><meta property="og:title" content="Household problem · Documentation for BASEforHANK module"/><meta property="twitter:title" content="Household problem · Documentation for BASEforHANK module"/><meta name="description" content="Documentation for Documentation for BASEforHANK module."/><meta property="og:description" content="Documentation for Documentation for BASEforHANK module."/><meta property="twitter:description" content="Documentation for Documentation for BASEforHANK module."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Documentation for BASEforHANK module</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../SteadyState/">Steady state</a></li><li><a class="tocitem" href="../PerturbationSolution/">Perturbation solution</a></li><li><a class="tocitem" href="../Estimation/">Estimation</a></li><li><a class="tocitem" href="../PostEstimation/">Post estimation</a></li><li><a class="tocitem" href="../Tools/">Tools</a></li><li><a class="tocitem" href="../Parsing/">Parser</a></li><li class="is-active"><a class="tocitem" href>Household problem</a><ul class="internal"><li><a class="tocitem" href="#Model-setup"><span>Model setup</span></a></li><li><a class="tocitem" href="#Preferences"><span>Preferences</span></a></li><li><a class="tocitem" href="#Income-taxation"><span>Income taxation</span></a></li><li><a class="tocitem" href="#Idiosyncratic-productivity"><span>Idiosyncratic productivity</span></a></li><li><a class="tocitem" href="#Budget-constraint"><span>Budget constraint</span></a></li><li><a class="tocitem" href="#Asset-market"><span>Asset market</span></a></li><li><a class="tocitem" href="#Underlying-decision-problem"><span>Underlying decision problem</span></a></li><li><a class="tocitem" href="#Labor-supply-decision"><span>Labor supply decision</span></a></li><li><a class="tocitem" href="#Portfolio-choice"><span>Portfolio choice</span></a></li><li><a class="tocitem" href="#Inputs-to-the-household-problem"><span>Inputs to the household problem</span></a></li></ul></li><li><a class="tocitem" href="../examples/baseline/">Baseline example</a></li><li><a class="tocitem" href="../Computational Notes/">Computational Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Household problem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Household problem</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/BASEforHANK/BASEtoolbox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/main/docs/src/HouseholdProblem.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Documentation-of-the-household-problem"><a class="docs-heading-anchor" href="#Documentation-of-the-household-problem">Documentation of the household problem</a><a id="Documentation-of-the-household-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-of-the-household-problem" title="Permalink"></a></h1><p>&lt;span style=&quot;color:red&quot;&gt;<strong>TO DO: Note: this is a preliminary version, needs to be checked carefully and written more clearly.</strong>&lt;/span&gt;</p><p>This section documents the household problem that is at the core of the package. Most features are also present in BBL, however, the package extends the model. As a user, given the household problem, you can specify the &quot;surrounding&quot; aggregate equations that determine the inputs to the household problem. You can switch off features of the household problem by setting the parameters or variables accordingly.</p><p>The <strong>most important assumptions</strong> of the household problem are the following:</p><ol><li>GHH preferences with labor supply decision</li><li>Taxes: linear and progressive labor and entrepreneurial income tax, linear value-added tax, linear union-profit tax</li><li>Entrepreneurship as an idiocyncratic state</li><li>2 accounts: liquid and illiquid assets</li></ol><p>At the end of this section, we provide a list of <strong>necessary inputs</strong> to the household problem.</p><h2 id="Model-setup"><a class="docs-heading-anchor" href="#Model-setup">Model setup</a><a id="Model-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Model-setup" title="Permalink"></a></h2><p>There is a continuum of ex-ante identical households of measure one, indexed by <span>$i$</span>. Households are infinitely lived, have time-separable preferences with time-discount factor <span>$\beta$</span>, and derive felicity from consumption <span>$c_{it}$</span> and leisure. They obtain income from supplying labor, <span>$n_{it}$</span>, from renting out capital, <span>$k_{it}$</span>, and from earning interest on bonds, <span>$b_{it}$</span>. What is more, they (potentially) receive entrepreneurial profits, <span>$\Pi_t^E$</span>, and union profits, <span>$\Pi_t^U$</span>. Households pay taxes on labor and profit income as well as a value-added consumption tax.</p><p>The model features household heterogeneity. Households differ in their productivity and in whether they obtain profit income. They face incomplete markets, and capital as an asset is illiquid while bonds are liquid.</p><h2 id="Preferences"><a class="docs-heading-anchor" href="#Preferences">Preferences</a><a id="Preferences-1"></a><a class="docs-heading-anchor-permalink" href="#Preferences" title="Permalink"></a></h2><p>With respect to leisure and consumption, households have  GHH preferences and maximize the discounted sum of felicity</p><p class="math-container">\[\begin{align*}
    \mathbb{E}_0 \sum_{t=0}^\infty \beta^t u\left[c_{it} - G(h_{it},n_{it})\right].
\end{align*}\]</p><p>The maximization is subject to the budget constraints described further below. The felicity function <span>$u$</span> exhibits a constant relative risk aversion (CRRA) with risk aversion parameter <span>$\xi$</span>,</p><p class="math-container">\[\begin{align*}
    u(x_{it}) &amp;= \frac{x_{it}^{1-\xi}}{1-\xi}, \tag{CRRA}
\end{align*}\]</p><p>where <span>$x_{it} = c_{it} - G(h_{it},n _{it})$</span> is household <span>$i$</span>&#39;s composite demand for goods consumption, <span>$c_{it}$</span>, and leisure, and <span>$G$</span> measures the disutility from work. While <span>$n_{it}$</span> denotes household <span>$i$</span>&#39;s labor supply, <span>$h_{it}$</span> is the household&#39;s labor productivity.</p><p class="math-container">\[G(h_{it}, n_{it})\]</p><p>measures the disutility from work. We assume the following form for the disutility from work with <span>$\gamma&gt;0$</span>:</p><p class="math-container">\[\begin{align*}
    G(h_{it}, n_{it}) &amp;= h_{it}^{1-\tau^p} \frac{n_{it}^{1+\gamma}}{1+\gamma}.
\end{align*}\]</p><p>This functional form has several advantages that we will use below. First, the constant elasticity of <span>$G$</span> with respect to <span>$n_{it}$</span> simplifies the expression for the composite consumption good, <span>$x_{it}$</span>, in the budget constraint. When the Frisch elasticity of labor supply <span>$\gamma$</span> is constant and the tax schedule has the form specified below, the disutility of labor is always a fraction of labor income and constant across households. Therefore, in both the household&#39;s budget constraint and felicity function, only after-tax income enters and neither hours worked nor productivity appear separately. Second, scaling the disutility of labor by <span>$h_{it}^{1−\tau^p}$</span> ensures a normalization to one in the stationary equilibrium (see BBL p. 1220/1221 for details). In the exponent thereof, <span>$\tau^p$</span> represents the steady state level of progressivity of the tax code, explained below. The functional form simplifies the household problem as <span>$h_{it}$</span> drops out from the first-order condition as long as tax progressivity is constant. Then, all households supply the same number of hours. Yet, we allow for tax progressivity to vary over time below. Still, with this functional form, the household problem is more tractable.</p><h2 id="Income-taxation"><a class="docs-heading-anchor" href="#Income-taxation">Income taxation</a><a id="Income-taxation-1"></a><a class="docs-heading-anchor-permalink" href="#Income-taxation" title="Permalink"></a></h2><p>We assume a progressive labor and entrepreneurial income tax schedule as in BBL (with one modification explained below) given by</p><p class="math-container">\[\begin{align*}
    f_\tau(x) = (1-\tau^l_t) x^{1-\tau^p_t}  (\bar{Y}^g_t)^{\tau^p_t}. \tag{Tax func}
\end{align*}\]</p><p>Here (and this is the modification relative to BBL), the average level of gross income across households, <span>$\bar{Y}^g_t$</span>, influences individual taxing and thus net income, <span>$y^n_{it}$</span>. <span>$\tau^l_t$</span> and <span>$\tau^p_t$</span> determine the level and progressivity of the tax code.</p><p>The tax level shifter <span>$(\bar{Y}^g_t)^{\tau^p_t}$</span> ensures that in the corresponding representative agent economy, tax income (holding behavior constant) is independent of progressivity. To see this, plug in the average gross income, <span>$\bar{Y}^g_t$</span>, which corresponds to the gross income of a representative agent, as tax basis <span>$x$</span>. This gives <span>$f_\tau(\bar{Y}^g_t)= (1-\tau^l_t)\bar{Y}^g_t$</span>, so that in the corresponding representative agent economy, the tax progressivity vanishes. In the code, this tax level shifter can be easily switched off.</p><p>Income related to union profits, <span>$\Pi^U_t$</span>, is taxed at a rate <span>$\bar \tau_t$</span> that is independent of the recipient&#39;s labor income.</p><p>Asset income is not taxed.</p><h2 id="Idiosyncratic-productivity"><a class="docs-heading-anchor" href="#Idiosyncratic-productivity">Idiosyncratic productivity</a><a id="Idiosyncratic-productivity-1"></a><a class="docs-heading-anchor-permalink" href="#Idiosyncratic-productivity" title="Permalink"></a></h2><p>The household sector is subdivided into two types of agents: workers and entrepreneurs. The transition between both types is stochastic. On top, workers face idiosyncratic labor productivity risk. Both, workers and entrepreneurs, rent out physical capital, but only workers supply labor. Entrepreneurs do not work, but earn entrepreneurial profits, <span>$\Pi_t^E$</span>. Profits of unions, <span>$\Pi_t^U$</span>, are equally distributed across workers. All households self-insure against the income risks they face by saving in a liquid asset (bonds) and a less liquid asset (capital). Trading these illiquid assets is subject to random participation in the capital market.</p><p>We assume that productivity evolves according to a log-AR(1) process and a fixed probability of transition between the worker and the entrepreneur state:</p><p class="math-container">\[\tilde{h}_{it} =
\begin{cases}
\exp\left(\rho_{h} \log \tilde{h}_{it-1} + \epsilon^{h}_{it}\right) &amp; \text{with probability } 1-\zeta \text{ if } h_{it-1} \neq 0, \\
1 &amp; \text{with probability } \iota \text{ if } h_{it-1} = 0, \\
0 &amp; \text{else}.
\end{cases}\]</p><p>with individual productivity <span>$h_{it}= \frac{\tilde{h}_{it}}{\tilde{H}_{it}}$</span> such that <span>$\tilde h_{it}$</span> is scaled by its cross-sectional average, <span>$\tilde{H}_{it} = \int \tilde h_{it} di$</span>, to make  sure that average worker productivity is constant. The shocks <span>$\epsilon^{h}_{it}$</span> to productivity <span>$\tilde{h}_{it}$</span> are normally distributed with variance <span>$\bar \sigma^2_{h,t}$</span>.</p><p>With probability <span>$\zeta$</span> households become entrepreneurs (<span>$h=0$</span>). With probability <span>$\iota$</span> an entrepreneur returns to the labor force with median productivity. Besides their labor income, workers receive a share in union rents, <span>$\Pi^U_t$</span>, which are distributed lump sum, leading to labor-income compression. For tractability, we assume union profits to be taxed at a rate <span>$\bar{τ}_t$</span> independent of the recipient&#39;s labor income.</p><h2 id="Budget-constraint"><a class="docs-heading-anchor" href="#Budget-constraint">Budget constraint</a><a id="Budget-constraint-1"></a><a class="docs-heading-anchor-permalink" href="#Budget-constraint" title="Permalink"></a></h2><p>A household&#39;s net labor income, <span>$y^n_{it}$</span>, is given by</p><p class="math-container">\[\begin{align*}
    y^n_{it} = f_\tau (w^H_t h_{it} n_{it})
\end{align*}\]</p><p>where <span>$w^H_t$</span> is the real wage rate that household receive, <span>$h_{it}$</span> is the (scaled) productivity of the household, and <span>$n_{it}$</span> is the amount of labor supplied.</p><p>Given incomes, households optimize intertemporally subject to their budget constraint</p><p class="math-container">\[\begin{align*}
(1 + \tau^c_t) c_{it} + b_{it+1} + q_t k_{it+1} &amp;= RR^{i}_{t} b_{it} + (q_t + r^K_t)k_{it} + y^n_{it} + 1\{h_{it} \neq 0\}(1 - \bar \tau_t) \Pi^U_t + 1\{h_{it} = 0\} f_\tau(\Pi^E_t),
\end{align*}\]</p><p>where <span>$\Pi^U_t$</span> is union profits taxed at the average tax rate of labor income <span>$\bar \tau_t$</span>, <span>$\Pi^E_t$</span> is profit payouts to entrepreneurs, <span>$b_{it}$</span> is real liquid assets, <span>$k_{it}$</span> is the amount of illiquid assets, <span>$q_{t}$</span> is the price of these assets, <span>$r^K_{t}$</span> is their dividend, and <span>$RR^{i}_{t}$</span> is the gross real interest rate on liquid assets, which depends on whether the household (thus, the dependence on <span>$i$</span>) is a borrower or lender.</p><p>All households that do not participate in the capital market <span>$(k_{it+1}=k_{it})$</span> still obtain dividends and can adjust their liquid asset holdings. Depreciated capital has to be replaced for maintenance, such that the dividend, <span>$r^K_{t}$</span>, is the net return on capital. Holdings of bonds have to be above an exogenous debt limit <span>$\underline{B},$</span> and holdings of capital have to be non-negative, that is</p><p class="math-container">\[k_{it+1} \geq 0, \quad b_{it+1} \geq \underline{B}.\]</p><p>Recall, <span>$f_\tau(\Pi_t^E)$</span> is the progressive tax function defined above, applied to profit payouts to entrepreneurs. In contrast, merely the average tax rate <span>$\bar \tau_t$</span> (further details below) is applied to the union&#39;s profits.</p><p>Additionally, consumption is taxed at a rate <span>$\tau^c_t$</span>, i.e. a VAT tax.</p><h3 id="Side-note:-computation-of-the-budget-constraint-elements-in-the-code"><a class="docs-heading-anchor" href="#Side-note:-computation-of-the-budget-constraint-elements-in-the-code">Side note: computation of the budget constraint elements in the code</a><a id="Side-note:-computation-of-the-budget-constraint-elements-in-the-code-1"></a><a class="docs-heading-anchor-permalink" href="#Side-note:-computation-of-the-budget-constraint-elements-in-the-code" title="Permalink"></a></h3><p>In the code, the elements of the budget constraint that are necessary to compute the household problem are computed by the <code>incomes()</code> function. Based on the parameters and aggregate variables, the function computes (at least) the following elements:</p><ol><li>Net labor and union income for workers, adjusted for the composite good / net entrepreneurial profits for entrepreneurs, that is <span>$y^n_{it} + 1\{h_{it} \neq 0\}(1 - \bar \tau_t) \Pi^U_t + 1\{h_{it} = 0\} f_\tau(\Pi^E_t)$</span> plus the adjustment for the composite good derived below.</li><li>Rental income from illiquid assets, that is <span>$r^K_t k_{it}$</span>.</li><li>Liquid asset income, that is <span>$RR^{i}_{t} b_{it}$</span>.</li><li>Liquidation income from illiquid assets, that is <span>$q_t k_{it+1}$</span>.</li></ol><h2 id="Asset-market"><a class="docs-heading-anchor" href="#Asset-market">Asset market</a><a id="Asset-market-1"></a><a class="docs-heading-anchor-permalink" href="#Asset-market" title="Permalink"></a></h2><p>Households make their savings and portfolio choice between liquid bonds and illiquid capital in light of a capital market friction that renders capital illiquid because participation in the capital market is random and i.i.d. in the sense that only a fraction <span>$\lambda$</span> of households are selected to be able to adjust their capital holdings in a given period.</p><p>The ex-post real return on the liquid asset, <span>$RR^{i}_{t}$</span>, is</p><p class="math-container">\[\begin{align*}
    RR^{i}_{t} =
\begin{cases}
    RR^{L}_{t} &amp; \text{ if } b_{it} \geq 0, \\
    RR^{D}_{t} &amp; \text{ else}. \tag{Return liquid}
\end{cases}
\end{align*}\]</p><p>Here, <span>$RR^{L}_{t}$</span> is the real lending rate and <span>$RR^{D}_{t}$</span> is the real borrowing rate. There is potentially a wedge between the two rates.</p><h2 id="Underlying-decision-problem"><a class="docs-heading-anchor" href="#Underlying-decision-problem">Underlying decision problem</a><a id="Underlying-decision-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Underlying-decision-problem" title="Permalink"></a></h2><p>Households face the following decision problem:</p><p class="math-container">\[\begin{align*}
    \max_{\left\{c_{it},n_{it},b_{it+1},k_{it+1}\right\}} \mathbb{E}_0 \sum_{t=0}^\infty \beta^t u\left[c_{it} - G(h_{it},n_{it})\right],
\end{align*}\]</p><p>subject to the budget constraint and both short-selling constraints.</p><p>Moreover, as stated above, the household might not be able to adjust its capital holdings in a given period. Expectations are thus formed over income states and the stochastic participation on the capital market. In periods, where the household cannot adjust, it faces the same problem except for the additional condition <span>$k_{it+1} = k_{it}$</span>.</p><h2 id="Labor-supply-decision"><a class="docs-heading-anchor" href="#Labor-supply-decision">Labor supply decision</a><a id="Labor-supply-decision-1"></a><a class="docs-heading-anchor-permalink" href="#Labor-supply-decision" title="Permalink"></a></h2><p>Consider the following Lagrangian of the household problem (ignoring the asset choice here, since it is not relevant for the labor supply decision):</p><p class="math-container">\[\begin{align*}
\mathcal{L} &amp;= E_0 \sum_{t=0}^\infty \beta^t \Bigg( u(c_{it} - G(h_{it}, n_{it})) + \lambda_{it} \left[ RR^{i}_{t} b_{it} + (q_t + r^K_t) k_{it} + y^n_{it} + 1\{h_{it} \neq 0\}(1 - \bar \tau_t)\Pi^U_t + 1\{h_{it} = 0\} f_\tau(\Pi^E_t) - (1 + \tau^c_t) c_{it}
 - b_{it+1} - q_t k_{it+1}\right] + \dots \Bigg)
\end{align*}\]</p><p>Remember, <span>$y^n_{it}$</span> denotes the household&#39;s net labor income.</p><p>Combining the first-order conditions with respect to labor <span>$n_{it}$</span> and consumption <span>$c_{it}$</span> yields:</p><p class="math-container">\[\begin{align*}
\frac{\partial G(h_{it}, n_{it})}{\partial n_{it}} &amp;= \frac{1}{(1 + \tau^c_t)}\frac{\partial y^n_{it}}{\partial n_{it}} = \frac{1}{(1 + \tau^c_t)} (1- \tau^p) \frac{y^n_{it}}{n_{it}}. \tag{FOC labor}
\end{align*}\]</p><p>Together with <span>$\partial G(h_{it}, n_{it})/ \partial n_{it} = (1+\gamma)[G(h_{it}, n_{it})/n_{it}]$</span> (see above), we can express the composite consumption good, <span>$x_{it}$</span>, as</p><p class="math-container">\[\begin{align*}
x_{it} = c_{it} - G(h_{it}, n_{it}) &amp;= c_{it} - \frac{1}{1+\gamma} \frac{1-\tau^p_t}{1+\tau^c_t}  y^n_{it}. \tag{Cons comp labor}
\end{align*}\]</p><p>We allow for the parameter <span>$\tau^p_t$</span> governing the progressivity of the tax schedule to vary over time. In this case, as explained in footnote 12 of BBL, whenever tax progressivity does not coincide with its steady state level <span>$\tau^p$</span>, individual hours worked differ across agents. The labor supply under time-varying tax progressivity can be derived from eq. (FOC labor) and is similar to BBL equation (19a). It is given by:</p><p class="math-container">\[n_{it} = \left[ \frac{(1 - \tau^p_t)(1 - \tau^l_t)}{(1+\tau^c_t)}  (\bar{Y}^g_t)^{\tau^p_t} \right]^{\frac{1}{\gamma + \tau^p_t}}
(w^H_t)^{\frac{1 - \tau^p_t}{\gamma + \tau^p_t}}
h_{it}^{\frac{\tau^p - \tau^p_t}{\gamma + \tau^p_t}}\]</p><p>On aggregate, this results in total effective hours (compare equation (19b) of BBL):</p><p class="math-container">\[N_t = \int n_{it}h_{it} \, di = \left[ \frac{(1 - \tau^p_t)(1 - \tau^l_t)}{(1+\tau^c_t)}  (\bar{Y}^g_t)^{\tau^p_t} \right]^{\frac{1}{\gamma + \tau^p_t}}
(w^H_t)^{\frac{1 - \tau^p_t}{\gamma + \tau^p_t}} \underbrace{\int h_{it}^{\frac{\gamma + \tau^p}{\gamma + \tau^p_t}} \, di}_{=: H^p_t}, \tag{Total hours}\]</p><p>Individual hours worked, <span>$n_{it}$</span>, can thus be written as a function of total effective hours <span>$N_{t}$</span>: <span>$n_{it}  = N_t/H^p_t  h_{it}^{(\tau^p - \tau^p_t)/(\gamma + \tau^p_t)}$</span>.</p><p>Given the labor decision, net income can be calculated.</p><p>We plug the optimal supply of hours, <span>$n_{it}$</span>, into the equation for net income, <span>$y^n_{it}$</span>, which is then (compared to equation (22) in BBL):</p><p class="math-container">\[\begin{align*}
y^n_{it} &amp;= (1 - \tau^l_t)(w^H_t h_{it} n_{it})^{1 - \tau^p_t} (\bar{Y}^g_t)^{\tau^p_t} = (1 - \tau^l_t)^{\frac{1+\gamma}{\gamma + \tau^p_t}}
 (1 - \tau^p_t) ^ {\frac{1-\tau^p_t}{\gamma + \tau^p_t}}
 (1 + \tau^c_t) ^ {-\frac{1-\tau^p_t}{\gamma + \tau^p_t}}
 w_t ^ {\frac{(1 + \gamma)(1 - \tau^p_t)}{\gamma + \tau^p_t}}
 h_{it} ^ {\frac{(\gamma + \tau^p)(1-\tau^p_t)}{\gamma + \tau^p_t}}
 (\bar{Y}^g_t)^{\frac{\tau^p_t (1+\gamma)}{\gamma + \tau^p_t}}.
 \end{align*}\]</p><p>Plugging individual hours as a function of total effective hours into gross income, results in</p><p class="math-container">\[y^g_{it} = w^H_t h_{it} n_{it} = w^H_t  \frac{N_t}{H^p_t}  h_{it}^\frac{\gamma + \tau^p}{\gamma + \tau^p_t}. \tag{Gross income}\]</p><p>Finally, consumption in the budget constraint can be replaced with the composite consumption good <span>$x_{it}$</span>:</p><p class="math-container">\[\begin{align*}
(1 + \tau^c_t) x_{it} + b_{it+1} + q_t k_{it+1} &amp;= RR^{i}_{t} b_{it} + (q_t + r^K_t)k_{it} + \left(1 - \frac{1-\tau^p_t}{1+\gamma}\right) y^n_{it} + 1\{h_{it} \neq 0\}(1 - \bar \tau_t) \Pi^U_t + 1\{h_{it} = 0\} f_\tau(\Pi^E_t), \tag{BC with x}
\end{align*}\]</p><p>where <span>$\left(1-\frac{1-\tau^p_t}{1+\gamma}\right)$</span> simplifies to <span>$\left(\frac{\tau^p_t + \gamma}{1+\gamma}\right)$</span>. This GHH factor is used in the code to transform net labor income, <span>$y^n_{it}$</span>, into the composite consumption good units. Here, we have to take the VAT additionally into account.</p><h2 id="Portfolio-choice"><a class="docs-heading-anchor" href="#Portfolio-choice">Portfolio choice</a><a id="Portfolio-choice-1"></a><a class="docs-heading-anchor-permalink" href="#Portfolio-choice" title="Permalink"></a></h2><h3 id="Description-of-the-dynamic-problem"><a class="docs-heading-anchor" href="#Description-of-the-dynamic-problem">Description of the dynamic problem</a><a id="Description-of-the-dynamic-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Description-of-the-dynamic-problem" title="Permalink"></a></h3><p>In the following, unlike in other sections of the documentation, we will adopt recursive notation (where a prime, <code>&#39;</code>, denotes next period&#39;s value) for clarity. Policy functions are denoted with a star, <code>*</code>, and subscripts indicate whether the policy pertains to the adjustment case, <code>a</code>, or the non-adjustment case, <code>n</code>. For example, <span>$x^*_a$</span> represents the policy function for the consumption-leisure bundle in the adjustment case, while <span>$x^*_n$</span> represents it in the non-adjustment case. For notational brevity, we refer to the consumption-leisure composite simply as consumption throughout.</p><p>Since a household&#39;s saving decision will be some non-linear function of that household&#39;s wealth and productivity, inflation and all other prices will be functions of the joint distribution, <span>$\Theta_t$</span>, of <span>$(b,k,h)$</span> in <span>$t$</span>. This makes <span>$\Theta_t$</span> a state variable of the household&#39;s planning problem. It evolves as a result of the economy&#39;s reaction to aggregate shocks according to:</p><p class="math-container">\[\begin{align*}
    \Theta_{t+1}(b&#39;,k&#39;,h&#39;) &amp;=\lambda \int _{b&#39;=b_{a,t}^*(b,k,h),k&#39;=k_t^*(b,k,h)}\Pi(h,h&#39;)d\Theta_{t}(b,k,h)
    + (1-\lambda) \int_{b&#39;=b_{n,t}^*(b,k,h),k&#39;=k}\Pi(h,h&#39;)d\Theta_{t}(b,k,h)\ ,
\end{align*}\]</p><p>where <span>$\Pi(\cdot)$</span> is the transition probability for <span>$h$</span> and <span>$b_{a/n,t}^*$</span> and <span>$k_t^*$</span> are the time-<span>$t$</span> optimal policies.</p><p>For simplicity, we summarize all effects of aggregate state variables, including the distribution of wealth and income, by writing the dynamic planning problem with time-dependent continuation values.</p><p>This leaves us with two Bellman equations, that characterize the household&#39;s problem: <span>$V^{a}_t$</span> for the case where the household adjusts its capital holdings and <span>$V^{n}_t$</span> for the case in which it does not adjust. A third function defines the expected continuation value, <span>$\mathbb{W}_t$</span>, over both,</p><p class="math-container">\[\begin{align*}
V^{a}_t(b,k,h) =&amp; \max_{b_{a}&#39;,k&#39;}  u[x(b,b_{a}&#39;,k,k&#39;,h)]+ \beta\mathbb{E}_t \mathbb{W}_{t+1}(b_{a}&#39;,k&#39;,h&#39;)\ , \nonumber\\
V^{n}_t(b,k,h) =&amp; \max_{b_{n}&#39;}  u[x(b,b_{n}&#39;,k,k,h)] + \beta \mathbb{E}_t\mathbb{W}_{t+1}(b_{n}&#39;,k,h&#39;)\ , \\
\mathbb{W}_{t+1}(b&#39;,k&#39;,h&#39;) =&amp; \lambda V_{t+1}^{a}(b&#39;,k&#39;,h&#39;) +(1-\lambda)V^{n}_{t+1}(b&#39;,k&#39;,h&#39;) \ .\nonumber
\end{align*}\]</p><p>Expectations about the continuation value are taken with respect to all stochastic processes (i.e. with respect to idiosyncratic and aggregate variables) conditional on the current states.</p><p>The budget sets for the adjustment case <span>$\Gamma_a$</span> and the non-adjustment case <span>$\Gamma_n$</span> are given by</p><p class="math-container">\[\begin{align*}
    \Gamma_{a}(b,k,h) &amp;= \Bigg\{ k&#39; \geq 0, b&#39; \geq \underline{B} \mid q (k&#39; - k) + b&#39; \leq \left(\frac{\tau^p + \gamma}{1+\gamma}\right) y^n + RR(b) b + r^K k \\
    &amp; + 1\{h \neq 0\}(1- \tau)\Pi^U + 1\{h = 0\} f_\tau(\Pi^E) \Bigg\} \\
    \Gamma_{n}(b,k,h) &amp;= \Bigg\{b&#39; \geq \underline{B} \mid  b&#39;\leq \left(\frac{\tau^p + \gamma}{1+\gamma}\right) y^n + RR(b) b + r^K k \\
    &amp; + 1\{h_{it} \neq 0\}(1- \tau)\Pi^U + 1\{h_{it} = 0\} f_\tau(\Pi^E) \Bigg\}.
\end{align*}\]</p><p>Moreover, the consumption leisure composite <span>$x$</span> is</p><p class="math-container">\[\begin{align*}
    x(b,b&#39;,k,k&#39;,h) &amp;= \frac{1}{1+\tau^c} \Bigg[ \left(\frac{\tau^p + \gamma}{1+\gamma}\right) y^n + RR(b) b + r^K k \\
    &amp; + 1\{h \neq 0\}(1- \tau)\Pi^U + 1\{h = 0\} f_\tau(\Pi^E) - b&#39; - q (k&#39; - k) \Bigg].
\end{align*}\]</p><p>As <a href="https://onlinelibrary.wiley.com/doi/full/10.3982/ECTA13601">Bayer, Luetticke, Pham-Dao and Tjaden (2019)</a> show in the online Appendix B, the Bellman equation fullfills Blackwell&#39;s sufficient condition for a contraction on the set of bounded, continuous and weakly concave functions, such that we can expect to find a solution to the problem.</p><p>When solving the problem, we do not use the value functions. Instead, we rely on the first-order conditions that characterize the optimal household behavior to solve for policy functions. The next section develops the equations that are necessary for an iterative algorithm that solves for optimal policies, before we describe the exact algorithm thereafter.</p><h3 id="Euler-Equations"><a class="docs-heading-anchor" href="#Euler-Equations">Euler Equations</a><a id="Euler-Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Euler-Equations" title="Permalink"></a></h3><p>Denote the optimal policies for consumption, for liquid asset holdings and illiquid asset holdings as <span>$x_a^{*}$</span>, <span>$b_a^{*}$</span>, <span>$k_a^{*}$</span>, <span>$x_n^{*}$</span>, and <span>$b_n^{*}$</span>, respectively. The first-order conditions (FOCs) for a solution in the adjustment case and the non-adjustment case read:</p><p class="math-container">\[\begin{align*}
    k^{*}_a: &amp;\quad  \frac{\partial u(x^{*}_{a})}{\partial x} \geq (1 + \tau^c) q^{-1} \beta \, \mathbb E \, \frac{\partial \mathbb W (b^{*}_{a} ,k^{*}_a ,h&#39;)}{\partial k} \tag{FOC1} \\
    b^{*}_{a}: &amp;\quad \frac{\partial u(x^{*}_{a})}{\partial x} \geq (1 + \tau^c) \beta \, \mathbb E \, \frac{\partial \mathbb W (b^{*}_{a}, k^{*}_a, h&#39;)}{\partial b} \tag{FOC2} \\
    b^{*}_{n}: &amp;\quad \frac{\partial u(x^{*}_{n})}{\partial x} \geq (1 + \tau^c) \beta \, \mathbb E \, \frac{\partial \mathbb W (b^{*}_{n}, k, h&#39;)}{\partial b} \tag{FOC3}
\end{align*}\]</p><p>Note the subtle difference between (FOC2) and (FOC3), which lies in the different illiquid assets stocks <span>$k^{*}_a$</span> vs. <span>$k$</span> entering as arguments on the right-hand-side. The difference arises from the asset market friction that only allows a fraction of households to adjust their illiquid asset holding. The continuation values (CVs) are defined as:</p><p class="math-container">\[\begin{align*}
    \frac{\partial \mathbb W}{\partial k} (b&#39;, k&#39;, h&#39;) &amp;=  \lambda \frac{\partial V_{a}(b&#39;, k&#39;, h&#39;)}{\partial k} + (1 - \lambda)\frac{\partial V_{n}(b&#39;, k&#39;, h&#39;)}{\partial k} \tag{CV1} \\
    \frac{\partial \mathbb W}{\partial b} (b&#39;, k&#39;, h&#39;) &amp;= \lambda \frac{\partial V_{a}(b&#39;, k&#39;, h&#39;)}{\partial b} + (1 - \lambda)\frac{\partial V_{n}(b&#39;, k&#39;, h&#39;)}{\partial b} \tag{CV2}
\end{align*}\]</p><p>To characterize continuation values, we calculate the derivatives of the value functions for the adjustment and non-adjustment cases with respect to liquid and illiquid assets. Using the Envelope conditions (ECs), we obtain:</p><p class="math-container">\[\begin{align*}
    \frac{\partial V_{a}}{\partial k}(b, k, h) &amp;= \frac{\partial u[x^{*}_{a}(b, k, h)]}{\partial x} \left( \frac{q + r^K}{1 + \tau^c} \right) \tag{EC1} \\
    \frac{\partial V_{a}}{\partial b}(b, k, h) &amp;= \frac{\partial u[x^{*}_{a}(b, k, h)]}{\partial x} RR(b) \frac{1}{1 + \tau^c} \tag{EC2} \\
    \frac{\partial V_{n}}{\partial b}(b, k, h) &amp;= \frac{\partial u[x^{*}_{n}(b, k, h)]}{\partial x} RR(b) \frac{1}{1 + \tau^c} \tag{EC3} \\
    \frac{\partial V_{n}}{\partial k}(b, k, h) &amp;= \frac{\partial u[x^{*}_{n}(b, k, h)]}{\partial x} \left(\frac{r^K}{1 + \tau^c}\right) \\
    &amp; \quad + \beta \, \mathbb E \left[ \lambda \frac{\partial V_{a}[b^{*}_{n}(b, k, h), k, h&#39;]}{\partial k} + (1 - \lambda)\frac{\partial V_{n}[b^{*}_{n}(b, k, h), k, h&#39;]}{\partial k}\right] \\
    &amp;= \frac{\partial u[x^{*}_{n}(b, k, h)]}{\partial x} \left(\frac{r^K}{1 + \tau^c}\right) + \beta \, \mathbb{E} \frac{\partial \mathbb W [b^{*}_{n}(b, k, h), k, h&#39;]}{\partial k} \tag{EC4}
\end{align*}\]</p><p>such that the marginal value of the illiquid asset in the non-adjustment case is defined recursively.</p><p>By substituting the Envelope conditions (ECs) into the continuation values (CVs) and the composite expression into the first-order conditions (FOCs), we derive the Euler equations (EEs) that characterize optimal household behavior. Using a slightly simplified notation, these are given by the following equations:</p><p class="math-container">\[\begin{align*}
    \frac{\partial u[x_{a}^{*}(b, k, h)]}{\partial x} &amp;\geq q^{-1} \beta \, \mathbb E (1 + \tau^c) \left[ \lambda  \frac{\partial u[x^{*}_{a}(b^{*}_{a}, k^{*}_a, h&#39;)]}{\partial x} \left( \frac{q&#39;+{r^K}&#39;}{1 + {\tau^c}&#39;} \right) + (1-\lambda)\frac{\partial V_{n}}{\partial k} (b_{a}^{*},k^{*}_a, h&#39;) \right] \tag{EE1} \\
    \frac{\partial u[x_{a}^{*}(b,k, h)]}{\partial x} &amp;\geq \beta \, \mathbb E RR(b^{*})&#39; \left( \frac{1 + \tau^c}{1 + {\tau^c}&#39;} \right) \left[ \lambda  \frac{\partial u[x^{*}_{a}(b^{*}_{a},k^{*}_a, h&#39;)]}{\partial x} + (1-\lambda)\frac{\partial u[x^{*}_{n}(b_{a}^{*},k^{*}_a, h&#39;)]}{\partial x}\right] \tag{EE2} \\
    \frac{\partial u[x_{n}^{*}(b,k, h)]}{\partial x}  &amp;\geq \beta \, \mathbb E RR(b^{*})&#39; \left( \frac{1 + \tau^c}{1 + {\tau^c}&#39;} \right) \left[ \lambda  \frac{\partial u[x_{a}^{*}(b_{n}^{*},k, h&#39;)]}{\partial x} + (1-\lambda)\frac{\partial u[x_{n}^{*}(b_{n}^{*},k, h&#39;)]}{\partial x}\right] \tag{EE3}
\end{align*}\]</p><p>In the non-adjustment case, the intuition behind the Euler equation is standard: the household equates the marginal loss of utility today from saving an additional unit with the expected marginal utility gain from saving that unit.</p><p>In the adjustment case, the household also faces a portfolio problem. Intuitively, it selects the optimal combination of the liquid and illiquid assets by comparing the expected one-period return difference between the two assets, <span>$\mathbb E \left( RR(b^{*})&#39; - \frac{{r^K}&#39; + q&#39;}{q} \right)$</span>, weighted by the probability-adjusted marginal utilities. (We abstract from the non-differentiability at <span>$b=0$</span>.) After having decided the optimal portfolio combination, the household then faces the identical tradeoff between consumption today and consumption tomorrow as in the non-adjustment case.</p><h3 id="Solving-the-dynamic-planning-problem"><a class="docs-heading-anchor" href="#Solving-the-dynamic-planning-problem">Solving the dynamic planning problem</a><a id="Solving-the-dynamic-planning-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-dynamic-planning-problem" title="Permalink"></a></h3><p>The endogenous grid algorithm (EGM) is used to solve the dynamic household problem with two assets. The first-order conditions and Euler equations, which were derived above, form the foundation of the iterative algorithm. The document <a href="../Computational Notes/"><code>Computational Notes.md</code></a> provides a step-by-step explanation of the computational procedure implemented in the code.</p><h2 id="Inputs-to-the-household-problem"><a class="docs-heading-anchor" href="#Inputs-to-the-household-problem">Inputs to the household problem</a><a id="Inputs-to-the-household-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Inputs-to-the-household-problem" title="Permalink"></a></h2><h3 id="Inputs:-Parameters"><a class="docs-heading-anchor" href="#Inputs:-Parameters">Inputs: Parameters</a><a id="Inputs:-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Inputs:-Parameters" title="Permalink"></a></h3><ul><li>time-discount factor, <span>$\beta$</span></li><li>risk aversion parameter, <span>$\xi$</span></li><li>Frisch elasticity of labor supply, <span>$\gamma$</span></li><li>steady-state progressivity of the tax code, <span>$\tau^p$</span></li><li>persistence of the productivity shock, <span>$\rho_h$</span></li><li>variance of the productivity shock, <span>$\bar \sigma^2_{h}$</span></li><li>probability of becoming an entrepreneur, <span>$\zeta$</span></li><li>probability of returning to the labor force, <span>$\iota$</span></li><li>debt limit, <span>$\underline{B}$</span></li><li>probability of adjusting illiquid assets, <span>$\lambda$</span></li></ul><h3 id="Inputs:-Aggregate-variables"><a class="docs-heading-anchor" href="#Inputs:-Aggregate-variables">Inputs: Aggregate variables</a><a id="Inputs:-Aggregate-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Inputs:-Aggregate-variables" title="Permalink"></a></h3><ul><li>real wage rate that households receive, <span>$w^H_t$</span></li><li>level of the tax code, see tax function (Tax func), <span>$\tau^l_t$</span></li><li>progressivity of the tax code, see tax function (Tax func), <span>$\tau^p_t$</span></li><li>average gross income across households, see tax function (Tax func), <span>$\bar{Y}^g_t$</span></li><li>variance of the productivity shock, <span>$\bar \sigma^2_{h,t}$</span></li><li>union profits, <span>$\Pi^U_t$</span></li><li>entrepreneurial profits, <span>$\Pi^E_t$</span></li><li>tax rate on union profits, <span>$\bar \tau_t$</span></li><li>VAT tax rate, <span>$\tau^c_t$</span></li><li>price of illiquid assets, <span>$q_t$</span></li><li>real dividend on illiquid assets, <span>$r^K_t$</span></li><li>real lending rate, <span>$RR^{L}_t$</span></li><li>real borrowing rate, <span>$RR^{D}_t$</span></li><li>cross-sectional average of productivity before scaling, <span>$\tilde{H}_t$</span></li><li>cross-sectional average of productivity, weighted by tax progressivity factor, <span>$H^p_t$</span></li><li>total effective hours, <span>$N_t$</span></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Parsing/">« Parser</a><a class="docs-footer-nextpage" href="../examples/baseline/">Baseline example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Monday 28 April 2025 14:30">Monday 28 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
