<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Perturbation solution · Documentation for BASEforHANK module</title><meta name="title" content="Perturbation solution · Documentation for BASEforHANK module"/><meta property="og:title" content="Perturbation solution · Documentation for BASEforHANK module"/><meta property="twitter:title" content="Perturbation solution · Documentation for BASEforHANK module"/><meta name="description" content="Documentation for Documentation for BASEforHANK module."/><meta property="og:description" content="Documentation for Documentation for BASEforHANK module."/><meta property="twitter:description" content="Documentation for Documentation for BASEforHANK module."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Documentation for BASEforHANK module</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../SteadyState/">Steady state</a></li><li class="is-active"><a class="tocitem" href>Perturbation solution</a><ul class="internal"><li><a class="tocitem" href="#linearize_full_model()"><span><code>linearize_full_model()</code></span></a></li><li><a class="tocitem" href="#model_reduction()"><span><code>model_reduction()</code></span></a></li><li><a class="tocitem" href="#update_model()"><span><code>update_model()</code></span></a></li></ul></li><li><a class="tocitem" href="../Estimation/">Estimation</a></li><li><a class="tocitem" href="../PostEstimation/">Post estimation</a></li><li><a class="tocitem" href="../Tools/">Tools</a></li><li><a class="tocitem" href="../Parsing/">Parser</a></li><li><a class="tocitem" href="../HouseholdProblem/">Household problem</a></li><li><a class="tocitem" href="../examples/baseline/">Baseline example</a></li><li><a class="tocitem" href="../Computational Notes/">Computational Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Perturbation solution</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Perturbation solution</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/BASEforHANK/BASEtoolbox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/main/docs/src/PerturbationSolution.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Linear-perturbation-around-steady-state"><a class="docs-heading-anchor" href="#Linear-perturbation-around-steady-state">Linear perturbation around steady state</a><a id="Linear-perturbation-around-steady-state-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-perturbation-around-steady-state" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The main functions of this section are in the Submodule <code>PerturbationSolution</code>.</p></div></div><p>The model is linearized with respect to aggregate variables. For this, we write the equilibrium conditions in the form of <span>$F(X,X&#39;)=0$</span>, where <span>$X$</span> and <span>$X&#39;$</span> are (expected) deviations from steady state in two successive periods. Applying the total differential yields <span>$A*X&#39; = - B*X$</span>, where <span>$A$</span>,<span>$B$</span> are the first derivatives of <span>$F$</span> with respect to <span>$X&#39;$</span>,<span>$X$</span>. In the standard setting, we use the generalized Schur decomposition <sup class="footnote-reference"><a id="citeref-Klein" href="#footnote-Klein">[Klein]</a></sup> to transform this equation into a linearized observation equation <span>$d = gx*k$</span> and a linearized state transition equation <span>$k&#39; = hx*k$</span>, where <span>$k$</span> is a vector of the <em>state</em> variables and <span>$d$</span> is a vector of the <em>control</em> variables, <span>$X = \begin{bmatrix} k &amp; d \end{bmatrix}&#39;$</span>.</p><p>In our code, <span>$F$</span> is implemented as <a href="#BASEforHANK.PerturbationSolution.Fsys"><code>BASEforHANK.PerturbationSolution.Fsys()</code></a>, while differentiating and solving for <span>$gx$</span> and <span>$hx$</span> is done in <a href="#BASEforHANK.PerturbationSolution.LinearSolution"><code>BASEforHANK.PerturbationSolution.LinearSolution()</code></a>, called by <a href="#linearize_full_model()"><code>linearize_full_model()</code></a> returns the results as a <code>struct</code> <code>LinearResults</code>:</p><h2 id="linearize_full_model()"><a class="docs-heading-anchor" href="#linearize_full_model()"><code>linearize_full_model()</code></a><a id="linearize_full_model()-1"></a><a class="docs-heading-anchor-permalink" href="#linearize_full_model()" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.linearize_full_model" href="#BASEforHANK.linearize_full_model"><code>BASEforHANK.linearize_full_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">linearize_full_model(sr, m_par; ss_only = false)</code></pre><p>Linearize the full model (i.e. including idiosyncratic states and controls) around the steady state, and solves using <a href="#LinearSolution()"><code>LinearSolution()</code></a>.</p><p><strong>Arguments</strong></p><ul><li><code>sr::SteadyResults</code>: Output of <a href="../SteadyState/#BASEforHANK.call_prepare_linearization"><code>call_prepare_linearization()</code></a></li><li><code>m_par::ModelParameters</code></li><li><code>ss_only::Bool</code>: If <code>true</code>, only the steady state is checked</li></ul><p><strong>Returns</strong></p><ul><li><p><code>LinearResults</code>, containing</p><ul><li><code>State2Control::Array{Float64,2}</code>: Matrix of observation equation</li><li><code>LOMstate::Array{Float64,2}</code>: Matrix of state transition equation</li><li><code>A::Array{Float64,2}</code>,<code>B::Array{Float64,2}</code>: First derivatives of <a href="#BASEforHANK.PerturbationSolution.Fsys"><code>PerturbationSolution.Fsys()</code></a> with respect to arguments <code>X</code> [<code>B</code>] and <code>XPrime</code> [<code>A</code>]</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/BASEforHANK.jl#L203-L222">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.PerturbationSolution.LinearSolution" href="#BASEforHANK.PerturbationSolution.LinearSolution"><code>BASEforHANK.PerturbationSolution.LinearSolution</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">LinearSolution(sr, m_par, A, B; allow_approx_sol = true, ss_only = false)</code></pre><p>Calculate the linearized solution to the non-linear difference equations defined by function <a href="#Fsys()"><code>Fsys()</code></a>, using Schmitt-Grohé &amp; Uribe (JEDC 2004) style linearization (apply the implicit function theorem to obtain linear observation and state transition equations).</p><p>The Jacobian is calculated using the package <code>ForwardDiff</code></p><p><strong>Arguments</strong></p><ul><li><code>sr</code>: steady-state structure (variable values, indexes, numerical parameters, ...)</li><li><code>A</code>,<code>B</code>: derivative of <a href="#Fsys()"><code>Fsys()</code></a> with respect to arguments <code>X</code> [<code>B</code>] and   <code>XPrime</code> [<code>A</code>]</li><li><code>m_par</code>: model parameters</li><li><code>allow_approx_sol</code>: if <code>true</code>, the function will attempt to solve the linearized model   even if the system is indeterminate (shifting the critical eigenvalues)</li><li><code>ss_only</code>: if <code>true</code>, the function will only check if the steady state is a solution</li></ul><p><strong>Returns</strong></p><ul><li><code>gx</code>,<code>hx</code>: observation equations [<code>gx</code>] and state transition equations [<code>hx</code>]</li><li><code>alarm_LinearSolution</code>,<code>nk</code>: <code>alarm_LinearSolution=true</code> when solving algorithm fails, <code>nk</code> number of   predetermined variables</li><li><code>A</code>,<code>B</code>: first derivatives of <a href="#Fsys()"><code>Fsys()</code></a> with respect to arguments <code>X</code> [<code>B</code>] and   <code>XPrime</code> [<code>A</code>]</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/SubModules/PerturbationSolution/LinearSolution.jl#L1-L26">source</a></section></article><p>The function <code>linearize_full_model()</code> calls <code>LinearSolution</code> and stores the results in a <code>LinearResults</code> <code>struct</code>.</p><h3 id="LinearSolution()"><a class="docs-heading-anchor" href="#LinearSolution()"><code>LinearSolution()</code></a><a id="LinearSolution()-1"></a><a class="docs-heading-anchor-permalink" href="#LinearSolution()" title="Permalink"></a></h3><p>The <code>LinearSolution</code> function executes the following steps:</p><ul><li><p>generate devices to retrieve distribution and marginal value functions from   compressed states/controls (<code>Γ</code> and <code>DC</code>,<code>IDC</code>)</p></li><li><p>calculate the first derivative of <a href="#BASEforHANK.PerturbationSolution.Fsys"><code>BASEforHANK.PerturbationSolution.Fsys()</code></a> with respect to <code>X</code> and <code>XPrime</code>.   We use automatic differentiation (implemented in Julia by the package <code>ForwardDiff</code>).   Partial derivatives are calculated using the <code>ForwardDiff.jacobian()</code> function.   We exploit that some partial derivatives have known values (contemporaneous marginal value   functions and the future marginal distributions) and set them directly instead of calculating them <sup class="footnote-reference"><a id="citeref-BL" href="#footnote-BL">[BL]</a></sup>.</p></li><li><p>compute linear observation and state transition equations using the <a href="#BASEforHANK.PerturbationSolution.SolveDiffEq"><code>BASEforHANK.PerturbationSolution.SolveDiffEq()</code></a> function</p></li></ul><h3 id="SolveDiffEq()"><a class="docs-heading-anchor" href="#SolveDiffEq()"><code>SolveDiffEq()</code></a><a id="SolveDiffEq()-1"></a><a class="docs-heading-anchor-permalink" href="#SolveDiffEq()" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.PerturbationSolution.SolveDiffEq" href="#BASEforHANK.PerturbationSolution.SolveDiffEq"><code>BASEforHANK.PerturbationSolution.SolveDiffEq</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SolveDiffEq(A, B, n_par; allow_approx_sol)</code></pre><p>Calculate the solution to the linearized difference equations defined as P&#39;<em>B</em>P x<em>t = P&#39;<em>A</em>P x</em>{t+1}, where <code>P</code> is the (ntotal x r) semi-unitary model reduction matrix <code>n_par.PRightAll</code> of potentially reduced rank r.</p><p><strong>Arguments</strong></p><ul><li><code>A</code>,<code>B</code>: matrices with first derivatives</li><li><code>n_par::NumericalParameters</code>: <code>n_par.sol_algo</code> determines   the solution algorithm, options are:<ul><li><code>litx</code>:  Linear time iteration (implementation follows Reiter)</li><li><code>schur</code>: Klein&#39;s algorithm (preferable if number of controls is small)</li></ul></li><li><code>allow_approx_sol</code>: if <code>true</code> approximate solutions are allowed if the system is not unique and determinate</li></ul><p><strong>Returns</strong></p><ul><li><code>gx</code>,<code>hx</code>: observation equations [<code>gx</code>] and state transition equations [<code>hx</code>]</li><li><code>alarm_LinearSolution</code>,<code>nk</code>: <code>alarm_LinearSolution=true</code> when solving algorithm fails, <code>nk</code> number of   predetermined variables</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/SubModules/PerturbationSolution/SolveDiffEq.jl#L1-L20">source</a></section></article><ul><li>apply the model reduction by pre- and post-multiplying the reduction matrix <span>$\mathcal{P}$</span> to the Jacobians <code>A</code> and <code>B</code> that are inputs to <a href="#BASEforHANK.PerturbationSolution.SolveDiffEq"><code>BASEforHANK.PerturbationSolution.SolveDiffEq()</code></a>. <span>$\mathcal{P}$</span> is calculated in <a href="#model_reduction()"><code>model_reduction()</code></a> and stored in <code>n_par.PRightAll</code>.</li><li>compute linear observation and state transition equations. The solution algorithm is set   in <code>n_par.sol_algo</code>, with the options <code>:schur</code> (mentioned above) and <code>:litx</code> <sup class="footnote-reference"><a id="citeref-lit" href="#footnote-lit">[lit]</a></sup>. The results are matrices that map contemporaneous states to controls [<code>gx</code>],   or contemporaneous states to future states [<code>hx</code>]</li></ul><h3 id="Fsys()"><a class="docs-heading-anchor" href="#Fsys()"><code>Fsys()</code></a><a id="Fsys()-1"></a><a class="docs-heading-anchor-permalink" href="#Fsys()" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.PerturbationSolution.Fsys" href="#BASEforHANK.PerturbationSolution.Fsys"><code>BASEforHANK.PerturbationSolution.Fsys</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Fsys(X, XPrime, XSS, m_par, n_par, indexes, Γ, compressionIndexes, DC, IDC, DCD, IDCD; only_F = true)</code></pre><p>Equilibrium error function: returns deviations from equilibrium around steady state.</p><p>Split computation into <em>Aggregate Part</em>, handled by <a href="#BASEforHANK.PerturbationSolution.Fsys_agg"><code>Fsys_agg()</code></a> and <em>Heterogeneous Agent Part</em>.</p><p><strong>Arguments</strong></p><ul><li><p><code>X</code>,<code>XPrime</code>: deviations from steady state in periods t [<code>X</code>] and t+1 [<code>XPrime</code>]</p></li><li><p><code>XSS</code>: states and controls in steady state</p></li><li><p><code>Γ</code>, <code>DC</code>, <code>IDC</code>, <code>DCD</code>,<code>IDCD</code>: transformation matrices to retrieve:</p><ul><li>marginal distributions [<code>Γ</code>],</li><li>marginal value functions [<code>DC</code>,<code>IDC</code>], and</li><li>the (linear) interpolant of the copula [<code>DCD</code>,<code>IDCD</code>] from deviations</li></ul></li><li><p><code>indexes</code>,<code>compressionIndexes</code>: access <code>XSS</code> by variable names (DCT coefficients of compressed <span>$V_m$</span> and <span>$V_k$</span> in case of <code>compressionIndexes</code>)</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/SubModules/PerturbationSolution/FSYS.jl#L1-L21">source</a></section></article><p>The function <a href="#BASEforHANK.PerturbationSolution.Fsys"><code>BASEforHANK.PerturbationSolution.Fsys()</code></a> proceeds in the following way:</p><ol><li>set up vector <code>F</code>, that contains the errors to all equilibrium conditions. There are as many conditions  as deviations from steady state (length of <code>X</code>,<code>XPrime</code>), and conditions are indexed with  respective model variable in <code>IndexStruct</code> <code>indexes</code></li><li>generate locally all aggregate variables (for both periods) using <a href="../Parsing/#BASEforHANK.Parsing.@generate_equations"><code>BASEforHANK.Parsing.@generate_equations</code></a></li><li>construct the full-grid marginal distributions, marginal value functions, and the copula  from the steady-state values and the (compressed) deviations (for the copula, the selection of DCT  coefficients that can be perturbed ensures that also the perturbed function is a copula)</li><li>write all equilibrium condition-errors with respect to <em>aggregate</em> variables to <code>F</code>, using  <a href="#BASEforHANK.PerturbationSolution.Fsys_agg"><code>BASEforHANK.PerturbationSolution.Fsys_agg()</code></a></li><li>compute optimal policies with <a href="../SteadyState/#BASEforHANK.SteadyState.EGM_policyupdate"><code>BASEforHANK.SteadyState.EGM_policyupdate()</code></a>, given  future marginal value functions, prices, and individual incomes. Infer present marginal  value functions from them (envelope theorem) and set the difference to assumed present  marginal value functions (in terms of their compressed deviation from steady state)  as equilibrium condition-errors (<em>backward iteration of the value function</em>)</li><li>compute future marginal distributions and the copula (on the copula grid) from previous distribution and optimal asset policies. Interpolate when necessary. Set difference to assumed future marginal distributions and copula values on the copula nodes as equilibrium condition-errors (<em>forward iteration of the distribution</em>)</li><li>compute distribution summary statistics with <a href="../Tools/#BASEforHANK.Tools.distrSummaries"><code>BASEforHANK.Tools.distrSummaries()</code></a> and write  equilibrium conditions with their respective (control) variables</li><li>return <code>F</code></li></ol><p>Note that the copula is treated as the sum of two interpolants. An interpolant based on the steady-state distribution using the full steady-state marginals as a grid and a &quot;deviations&quot;-function that is defined on the copula grid generated in <code>prepare_linearization()</code>. The actual interpolation is carried out with <a href="../Tools/#BASEforHANK.Tools.myinterpolate3"><code>BASEforHANK.Tools.myinterpolate3()</code></a>. Default setting is trilinear interpolation, the code also allows for 3d-Akima interpolation.</p><h2 id="model_reduction()"><a class="docs-heading-anchor" href="#model_reduction()"><code>model_reduction()</code></a><a id="model_reduction()-1"></a><a class="docs-heading-anchor-permalink" href="#model_reduction()" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.PerturbationSolution.model_reduction" href="#BASEforHANK.PerturbationSolution.model_reduction"><code>BASEforHANK.PerturbationSolution.model_reduction</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">model_reduction()</code></pre><p>Produce Model Reduction based on Variance Covariance Matrix of States and Controls.</p><p><strong>Returns/ Updates</strong></p><p><code>SteadyResults</code>, containing returns of <a href="../SteadyState/#BASEforHANK.SteadyState.find_steadystate"><code>find_steadystate()</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/SubModules/PerturbationSolution/model_reduction.jl#L2-L9">source</a></section></article><p>The function <a href="#model_reduction()"><code>model_reduction()</code></a> derives the approximate factor representation from a first solution of the heterogeneous agent model.<sup class="footnote-reference"><a id="citeref-BBL" href="#footnote-BBL">[BBL]</a></sup> It then stores the matrices that allow to map the factors to the full set of state and control variables. For deriving the factor representation, the function calculates the long run variance-covariance matrix of all states of the model (given its first-stage reduction).</p><h2 id="update_model()"><a class="docs-heading-anchor" href="#update_model()"><code>update_model()</code></a><a id="update_model()-1"></a><a class="docs-heading-anchor-permalink" href="#update_model()" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.PerturbationSolution.update_model" href="#BASEforHANK.PerturbationSolution.update_model"><code>BASEforHANK.PerturbationSolution.update_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">update_model()</code></pre><p>Updates the linearized model (around the steady state, after parameter changes in the aggregate model) and solves, using <a href="../Estimation/#BASEforHANK.PerturbationSolution.LinearSolution_reduced_system"><code>LinearSolution_reduced_system()</code></a>. WARNING: The function is not threadsafe in the sense that calling it will alter the input(!) lr.A/B across threads, if lr is not local to the thread.</p><p><strong>Returns</strong></p><p><code>LinearResults</code>, containing</p><ul><li><code>A::Array{Float64,2}</code>,<code>B::Array{Float64,2}</code>: first derivatives of <a href="#Fsys()"><code>Fsys()</code></a> with   respect to arguments <code>X</code> [<code>B</code>] and <code>XPrime</code> [<code>A</code>]</li><li><code>State2Control::Array{Float64,2}</code>: observation equation</li><li><code>LOMstate::Array{Float64,2}</code>: state transition equation</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/SubModules/PerturbationSolution/update_model.jl#L2-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BASEforHANK.PerturbationSolution.Fsys_agg" href="#BASEforHANK.PerturbationSolution.Fsys_agg"><code>BASEforHANK.PerturbationSolution.Fsys_agg</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Fsys_agg(X, XPrime, XSS, distrSS, m_par, n_par, indexes)</code></pre><p>Return deviations from aggregate equilibrium conditions.</p><p><code>indexes</code> can be both <code>IndexStruct</code> or <code>IndexStructAggr</code>; in the latter case (which is how function is called by <a href="../Estimation/#BASEforHANK.PerturbationSolution.LinearSolution_reduced_system"><code>LinearSolution_reduced_system()</code></a>), variable-vectors <code>X</code>,<code>XPrime</code>, and <code>XSS</code> only contain the aggregate variables of the model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/52f8b0bdfc5685657502bd40ab169641cc55b07f/src/Preprocessor/template_fcns/FSYS_agg.jl#L13-L21">source</a></section></article><p>The function <a href="#update_model()"><code>update_model()</code></a> solves the aggregate model without updating the derivatives of the household/idiosyncratic part. For this purpose the derivatives of <a href="#BASEforHANK.PerturbationSolution.Fsys_agg"><code>BASEforHANK.PerturbationSolution.Fsys_agg()</code></a> are calculated instead of <code>Fsys()</code>. This substantially speeds up the solution after a parameter change that only affects aggregates.<sup class="footnote-reference"><a id="citeref-BBL" href="#footnote-BBL">[BBL]</a></sup> In particular, if the model is reduced to its approximate factor representation (see above), this generates significant speed gains.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Klein"><a class="tag is-link" href="#citeref-Klein">Klein</a>See the paper <a href="https://www.sciencedirect.com/science/article/pii/S0165188999000457">Using the generalized Schur form to solve a multivariate linear rational expectations model</a> by Paul Klein (JEDC 2000)</li><li class="footnote" id="footnote-BL"><a class="tag is-link" href="#citeref-BL">BL</a>Contemporaneous marginal value functions are irrelevant for optimal decisions, so its effect on other model variables is 0. Due to a rich enough set of prices, the future distribution directly only affects the Fokker-Planck equation. For details, see the paper <a href="https://doi.org/10.3982/QE1243">Solving heterogeneous agent models in discrete time with many idiosyncratic states by perturbation methods</a>, <em>Quantitative Economics</em>, Vol.11(4), November 2020, p. 1253-1288.</li><li class="footnote" id="footnote-BBL"><a class="tag is-link" href="#citeref-BBL">BBL</a>For details, see the paper <a href="https://www.benjaminborn.de/files/BBL_Inequality_Sep2023.pdf">Shocks, Frictions, and Inequality in US Business Cycles</a>, <em>American Economic Review</em>, forthcoming.</li><li class="footnote" id="footnote-lit"><a class="tag is-link" href="#citeref-lit">lit</a>Invoking the Implicit Function Theorem, there exist functions <span>$g$</span> and <span>$h$</span> such that <span>$F\left(\begin{pmatrix} k \\ g(k) \end{pmatrix},\begin{pmatrix} h(k) \\ g(h(k)) \end{pmatrix}\right)=0$</span>. Totally differentiating by <span>$k$</span> yields <span>$B \begin{pmatrix}\mathbb{I}\\ Dg \end{pmatrix}+A \begin{pmatrix}\mathbb{I}\\ Dg \end{pmatrix} Dh = 0$</span>. The <code>:lit</code>-algorithm solves this equation for <span>$Dg$</span> and <span>$Dh$</span> iteratively.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../SteadyState/">« Steady state</a><a class="docs-footer-nextpage" href="../Estimation/">Estimation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Monday 28 April 2025 14:30">Monday 28 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
