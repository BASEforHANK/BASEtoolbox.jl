<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Baseline example · Documentation for BASEforHANK module</title><meta name="title" content="Baseline example · Documentation for BASEforHANK module"/><meta property="og:title" content="Baseline example · Documentation for BASEforHANK module"/><meta property="twitter:title" content="Baseline example · Documentation for BASEforHANK module"/><meta name="description" content="Documentation for Documentation for BASEforHANK module."/><meta property="og:description" content="Documentation for Documentation for BASEforHANK module."/><meta property="twitter:description" content="Documentation for Documentation for BASEforHANK module."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Documentation for BASEforHANK module</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../SteadyState/">Steady state</a></li><li><a class="tocitem" href="../../PerturbationSolution/">Perturbation solution</a></li><li><a class="tocitem" href="../../Estimation/">Estimation</a></li><li><a class="tocitem" href="../../PostEstimation/">Post estimation</a></li><li><a class="tocitem" href="../../Tools/">Tools</a></li><li><a class="tocitem" href="../../Parsing/">Parser</a></li><li><a class="tocitem" href="../../HouseholdProblem/">Household problem</a></li><li class="is-active"><a class="tocitem" href>Baseline example</a><ul class="internal"><li><a class="tocitem" href="#Setup-of-the-model"><span>Setup of the model</span></a></li><li><a class="tocitem" href="#Header"><span>Header</span></a></li><li><a class="tocitem" href="#Steady-state-and-first-dimensionality-reduction"><span>Steady state and first dimensionality reduction</span></a></li><li><a class="tocitem" href="#Linearize-full-model"><span>Linearize full model</span></a></li><li><a class="tocitem" href="#Model-reduction"><span>Model reduction</span></a></li><li><a class="tocitem" href="#Model-solution-after-a-parameter-change-/-after-reduction"><span>Model solution after a parameter change / after reduction</span></a></li><li><a class="tocitem" href="#Estimation-of-model-parameters"><span>Estimation of model parameters</span></a></li></ul></li><li><a class="tocitem" href="../../Computational Notes/">Computational Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Baseline example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Baseline example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/BASEforHANK/BASEtoolbox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/BASEforHANK/BASEtoolbox.jl/blob/main/docs/src/examples/baseline.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Baseline-Example"><a class="docs-heading-anchor" href="#Baseline-Example">Baseline Example</a><a id="Baseline-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Baseline-Example" title="Permalink"></a></h1><p>This baseline example comes closest to the original paper (<a href="https://www.aeaweb.org/articles?id=10.1257/aer.20201875">Bayer, Born, and Luetticke (2024, AER)</a>). We provide two mainboards that accompany this example in the <code>examples/baseline/</code> folder:</p><ol><li><code>main.jl</code> which showcases the toolbox including the estimation part and</li><li><code>main_noestim.jl</code> which showcases the toolbox without the estimation part.</li></ol><p>In the following, we focus on <code>main.jl</code>.</p><p>Please refer to the main page of the documentation for general information on how to set up the toolbox.</p><p>The provided <code>main.jl</code> shows how a typical estimation proceeds in three main steps. First, we solve the steady state of the model. Then, the algorithm performs a two-step dimensionality reduction as described in the accompanying paper (<a href="https://www.aeaweb.org/articles?id=10.1257/aer.20201875">Bayer, Born, and Luetticke (2024, AER)</a>). The second step of this reduction uses the prior information to obtain and approximate factor representation from an initial, not further reduced solution. Secondly, we compute the linearized dynamics of the reduced model around the steady state. Thirdly, we construct the likelihood of the model parameters given the data and use Bayesian methods to estimate them. More details on the three steps are provided below and in the respective sections of the documentation.</p><p>Next, we move through <code>main.jl</code> step by step.</p><h2 id="Setup-of-the-model"><a class="docs-heading-anchor" href="#Setup-of-the-model">Setup of the model</a><a id="Setup-of-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-of-the-model" title="Permalink"></a></h2><p>To define the aggregate part of the baseline example&#39;s model, we included the aggregate model block in <code>examples/baseline/Model/</code>.</p><p>Firstly, we define the aggregate variables in <code>input_aggregate_names.jl</code>. In particular, we define a (symbolic) list of <em>shocks</em> as <code>shock_names</code>, a (string) list of <em>state variables</em> as <code>state_names</code>, and a (string) list of <em>control variables</em> as <code>control_names</code>. We also define a (string) list of <em>distributional statistics</em> that are just controls as <code>distr_names</code>.</p><p>Recall: These are only the aggregate variables so that the distribution (state) and the marginal utilities/value functions (controls) are not included here.</p><p>Importantly, some variables <strong>have to</strong> exist (with exactly these names and definitions). The reason for that is that these variables play a crucial role in the household problem, see also the in-detail explanation of the <a href="../../HouseholdProblem/"><code>HouseholdProblem.md</code></a>.</p><p>The steady state of the aggregate variables is defined in <code>input_aggregate_steady_state.mod</code>. Notably, there are a few exceptions which are provided using a different syntax. The reason for this is that these variables affect the household problem. Therefore, they are computed in <code>compute_args_hh_prob_ss</code> based on the user-provided functions in <code>input_functions.jl</code> as well as assumptions of the household problem and some further assumptions. If the user provides these steady state values also in <code>input_aggregate_steady_state.mod</code>, these will be compared to the values computed in <code>compute_args_hh_prob_ss</code> and a warning will be issued if they differ.</p><p>The file <code>input_parameters.jl</code> contains three structures to provide model parameters, numerical parameters, and estimation settings.</p><p>Model parameters that only affect the aggregate dynamics can be freely adjusted. Parameters that (also) affect the household problem <strong>have to</strong> exist (with exactly these names and definitions). The reason for that is that these variables play a crucial role in the household problem, see also the in-detail explanation of the <a href="../../HouseholdProblem/"><code>HouseholdProblem.md</code></a>. Each element of the <code>struct</code> <a href="../../SteadyState/#BASEforHANK.Parsing.ModelParameters"><code>ModelParameters</code></a> consists of a parameter name, its value, its ascii name, its long name, its LaTeX name, its prior (please see the <a href="https://github.com/JuliaStats/Distributions.jl">Distributions.jl</a>-package for available options), and a Boolean whether the parameter should be estimated or not.</p><p>The model parameters need to be set in your mainboard.</p><p>The <code>struct</code> <a href="../../SteadyState/#BASEforHANK.Parsing.NumericalParameters"><code>NumericalParameters</code></a> numerical parameters contain several types of parameters such as grids and meshes, variable types etc.</p><p>The numerical parameters are automatically set in <code>call_find_steadystate()</code>, based on their default values in <code>input_parameters.jl</code>, where the user can modify them.</p><p>Finally, the file <code>input_aggregate_model.jl</code> contains the aggregate model equations. The user has to provide the equations in the form of</p><pre><code class="language-julia hljs">F[equation number] = (lhs) - (rhs)</code></pre><p>where the equation number is based on an variable-specific index, to be explained later.</p><h2 id="Header"><a class="docs-heading-anchor" href="#Header">Header</a><a id="Header-1"></a><a class="docs-heading-anchor-permalink" href="#Header" title="Permalink"></a></h2><p>In this section, we set up the paths and pre-process the user&#39;s model inputs for the current example in the block</p><pre><code class="language-julia hljs">include(paths[&quot;src&quot;] * &quot;/Preprocessor/PreprocessInputs.jl&quot;);</code></pre><p>Notably, this already pre-processes the aggregate model equations as well as the steady state file that are located in the folder <code>examples/baseline/Model/</code> and produces the generated functions in the folder <code>bld/baseline/Preprocessor/generated_fcns/</code>. For more details on the pre-processing, see [...].</p><p>Importantly, this pre-processing has to be performed before loading the BASEforHANK module defined in <code>BASEforHANK.jl</code>, that is then loaded via</p><pre><code class="language-julia hljs">include(&quot;BASEforHANK.jl&quot;)
using .BASEforHANK</code></pre><p><code>BASEforHANK.jl</code> is the key module file as it loads in the code base, sets up structures, and exports a number of functions and macros.</p><h2 id="Steady-state-and-first-dimensionality-reduction"><a class="docs-heading-anchor" href="#Steady-state-and-first-dimensionality-reduction">Steady state and first dimensionality reduction</a><a id="Steady-state-and-first-dimensionality-reduction-1"></a><a class="docs-heading-anchor-permalink" href="#Steady-state-and-first-dimensionality-reduction" title="Permalink"></a></h2><p>The command</p><pre><code class="nohighlight hljs">sr_full = compute_steadystate(m_par)</code></pre><p>calls the functions <a href="../../SteadyState/#BASEforHANK.SteadyState.find_steadystate"><code>BASEforHANK.find_steadystate()</code></a> and <a href="../../SteadyState/#BASEforHANK.PerturbationSolution.prepare_linearization"><code>BASEforHANK.prepare_linearization()</code></a> and saves their returns in an instance <code>sr_full</code> of the <code>struct</code> <code>SteadyResults</code>. In exact, <code>sr_full</code> contains vectors of the steady-state variables (together with index-vectors to reference them by name) and the steady-state distribution of income and assets. It also contains the marginal value functions and the distributions as well as their first-stage model reduction counterparts (obtained through DCTs).</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p><code>sr_full</code> may be saved to the local file system by calling</p><pre><code class="nohighlight hljs">@save &quot;Output/Saves/steadystate.jld2&quot; sr_full</code></pre><p>and can be loaded for a future session with</p><pre><code class="nohighlight hljs">@load &quot;Output/Saves/steadystate.jld2&quot; sr_full</code></pre></div></div><p>More details can be found in the section &quot;Steady State&quot;.</p><h2 id="Linearize-full-model"><a class="docs-heading-anchor" href="#Linearize-full-model">Linearize full model</a><a id="Linearize-full-model-1"></a><a class="docs-heading-anchor-permalink" href="#Linearize-full-model" title="Permalink"></a></h2><p>After computing the steady state and saving it in the <code>SteadyResults</code>-struct named <code>sr_full</code>,</p><pre><code class="nohighlight hljs">lr_full = linearize_full_model(sr_full, m_par)</code></pre><p>computes the linear dynamics of the &quot;full&quot; model, i.e., using the first-stage model reduction, around the steady state (in the background, this calls <a href="../../PerturbationSolution/#BASEforHANK.PerturbationSolution.LinearSolution"><code>BASEforHANK.PerturbationSolution.LinearSolution()</code></a>) and saves a state-space representation in the instance <code>lr_full</code> of the <code>struct</code> <code>LinearResults</code> (see <a href="../../PerturbationSolution/#linearize_full_model()"><code>linearize_full_model()</code></a>).</p><p>Linearization of the full model takes a few seconds. The resulting state space is relatively large, because the copula and the value functions are treated fully flexible in this first step. As a result, also computing the first-order dynamics of this model takes a few seconds as well.</p><h2 id="Model-reduction"><a class="docs-heading-anchor" href="#Model-reduction">Model reduction</a><a id="Model-reduction-1"></a><a class="docs-heading-anchor-permalink" href="#Model-reduction" title="Permalink"></a></h2><p>This large state-space representation can, however, be reduced substantially using an approximate factor representation. For this purpose, we run</p><pre><code class="nohighlight hljs">sr_reduc    = model_reduction(sr_full, lr_full, m_par)</code></pre><p>which calculates the unconditional covariance matrix of all state and control variables and rewrites the coefficients of the value functions and the copula as linear combinations of some underlying factors. Only those factors that have eigenvalues above the precision predefined in <code>sr_full.n_par.compress_critC</code> (controls, i.e., marginal value functions) and <code>sr_full.n_par.compress_critS</code> (states, i.e., the copula) are retained.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>After model reduction, <code>sr_reduc.indexes_r</code> contains the indexes that map correctly into the states/controls used in <code>LOMstate</code> and <code>State2Control</code>.</p></div></div><h2 id="Model-solution-after-a-parameter-change-/-after-reduction"><a class="docs-heading-anchor" href="#Model-solution-after-a-parameter-change-/-after-reduction">Model solution after a parameter change / after reduction</a><a id="Model-solution-after-a-parameter-change-/-after-reduction-1"></a><a class="docs-heading-anchor-permalink" href="#Model-solution-after-a-parameter-change-/-after-reduction" title="Permalink"></a></h2><p>This smaller model (or any model after a parameter change that doesn&#39;t affect the steady state) can be solved quickly using a factorization result from <a href="https://www.aeaweb.org/articles?id=10.1257/aer.20201875">Bayer, Born, and Luetticke (2024, AER)</a> running</p><pre><code class="nohighlight hljs">lr_reduc    = update_model(sr_reduc, lr_full, m_par)</code></pre><p>In the background, this calls <a href="../../Estimation/#BASEforHANK.PerturbationSolution.LinearSolution_reduced_system"><code>BASEforHANK.PerturbationSolution.LinearSolution_reduced_system()</code></a>, which only updates the Jacobian entries that regard the <strong>aggregate</strong> model. (Note that both <a href="../../PerturbationSolution/#BASEforHANK.PerturbationSolution.LinearSolution"><code>BASEforHANK.PerturbationSolution.LinearSolution()</code></a> and <a href="../../Estimation/#BASEforHANK.PerturbationSolution.LinearSolution_reduced_system"><code>BASEforHANK.PerturbationSolution.LinearSolution_reduced_system()</code></a> call <a href="../../PerturbationSolution/#BASEforHANK.PerturbationSolution.SolveDiffEq"><code>BASEforHANK.PerturbationSolution.SolveDiffEq()</code></a> to obtain a solution to the linearized difference equation.)</p><p>This model update step takes about 100ms on a standard computer for the medium size resolution used as a default in the example code.</p><h2 id="Estimation-of-model-parameters"><a class="docs-heading-anchor" href="#Estimation-of-model-parameters">Estimation of model parameters</a><a id="Estimation-of-model-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Estimation-of-model-parameters" title="Permalink"></a></h2><p>Having obtained <code>SteadyResults</code> <code>sr_reduc</code> and <code>LinearResults</code> <code>lr_reduc</code>, the command</p><pre><code class="nohighlight hljs">er_mode = find_mode(sr_reduc, lr_reduc, m_par, e_set)</code></pre><p>computes the mode of the likelihood, i.e., the parameter vector that maximizes the probability of observing the data given the model, and saves the results in <code>er_mode</code>, an instance of <code>struct</code> <code>EstimResults</code> (see <a href="../../Estimation/#BASEforHANK.Estimation.mode_finding"><code>BASEforHANK.Estimation.mode_finding()</code></a>). We use the Kalman filter to compute the likelihood, and the package <code>Optim</code> for optimization. Settings for the estimation can be adjusted in the <code>struct</code> <a href="../../Estimation/#BASEforHANK.Parsing.EstimationSettings"><code>EstimationSettings</code></a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>By default, the flag <code>estimate_model</code> in the <code>struct</code> <a href="../../Estimation/#BASEforHANK.Parsing.EstimationSettings"><code>EstimationSettings</code></a> is set to <code>false</code>. Depending on the computing power available, finding the mode of the likelihood can take several hours to run through. The mode finder might also seem frozen after finishing the optimization but the computation of the Hessian for the large model is involved and can take a long time for the large model. For instructional purposes, we therefore set <code>e_set.compute_hessian = false</code> by default and load the Hessian from a save file. For a proper estimation, this has to be set to true. We also save an intermediate step before computing the Hessian in case you are only interested in the mode itself.</p></div></div><p>Lastly,</p><pre><code class="nohighlight hljs">sample_posterior(sr_reduc, lr_reduc, er_mode, m_par, e_set)</code></pre><p>uses a Markov Chain Monte Carlo method to trace out the posterior probabilites of the estimated parameters. The final estimates (and further results) are saved in a file with the name given by the field <code>save_posterior_file</code> in the <code>struct</code> <code>EstimationSettings</code> (instantiated in <code>e_set</code>).</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The module <code>BASEforHANK</code> creates the estimation settings <code>e_set</code> in its main script (when it is initialized), so changes to the <code>struct</code> <code>EstimationSettings</code> are only effective <em>before</em> <code>using BASEforHANK</code>. Make sure that all file paths specified in <a href="../../Estimation/#BASEforHANK.Parsing.EstimationSettings"><code>EstimationSettings</code></a> are correct relative to your script&#39;s position.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../HouseholdProblem/">« Household problem</a><a class="docs-footer-nextpage" href="../../Computational Notes/">Computational Notes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Monday 28 April 2025 14:33">Monday 28 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
